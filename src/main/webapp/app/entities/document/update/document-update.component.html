<div id="page-heading" class="row">
  <div class="col-6">
    <span>{{
      _activeMenuItem && _activeMenuItem.menuGroup.translateKey
        ? (_activeMenuItem.menuGroup.translateKey | translate)
        : _activeMenuItem?.menuGroup?.name
    }}</span>
    <span>
      >> {{ _activeMenuItem && _activeMenuItem.translateKey ? (_activeMenuItem.translateKey | translate) : _activeMenuItem?.name }}</span
    >
  </div>
  <div class="col-6 d-flex justify-content-end">
    <button [disabled]="!isSentApprove" type="button" id="cancel-save" class="btn btn-primary btn-sm" (click)="updateStatus(2)">
      <span class="d-none d-md-inline" jhiTranslate="entity.action.senttoapprove">Send to Approve</span>
    </button>
    <span style="width: 5px"></span>
    <button
      *ngIf="_userAuthority && _userAuthority.activeMenu.isWrite === 1"
      type="button"
      id="save-entity"
      data-cy="entityCreateSaveButton"
      class="btn btn-primary btn-sm"
      [disabled]="editForm.invalid || isSaving || docStatus_number === 6 || docStatus_number === 3 || docStatus_number === 5"
      [title]="saveBtnTitleChange()"
      (click)="save(1)"
    >
      <fa-icon icon="save"></fa-icon>
      <span class="d-none d-md-inline" jhiTranslate="entity.action.save">Save</span>
    </button>
    <span style="width: 5px"></span>

    <button [disabled]="!isCancel" type="button" id="cancel-save" class="btn btn-danger btn-sm" (click)="updateStatus(3)">
      <span class="d-none d-md-inline" jhiTranslate="entity.action.cancel">Cancel</span>
    </button>
    <span style="width: 5px"></span>

    <button type="button" id="cancel-save" class="btn btn-primary btn-sm" (click)="previousState()">
      <fa-icon icon="plus"></fa-icon>
      <span class="d-none d-md-inline" jhiTranslate="entity.action.new">New</span>
    </button>
  </div>
</div>

<div id="page-body">
  <form name="editForm" role="form" novalidate (ngSubmit)="save(1)" [formGroup]="editForm" autocomplete="off">
    <jhi-alert-error></jhi-alert-error>
    <div class="row">
      <div class="col-3">
        <div *ngIf="isDocMap" class="tab-header-select" (click)="showDocMap()">
          <fa-icon icon="angle-down" (click)="showDocMap()"></fa-icon>&nbsp;
          <span jhiTranslate="dmsApp.document.metadataLabel">MetaData Information</span>
        </div>

        <div *ngIf="!isDocMap" class="tab-header" (click)="showDocMap()">
          <fa-icon icon="angle-right" (click)="showDocMap()"></fa-icon>&nbsp;
          <span jhiTranslate="dmsApp.document.metadataLabel">MetaData Information</span>
        </div>
      </div>

      <div class="col-6">
        <div class="div-tab" *ngIf="isUploadDetail" class="tab-header-select" (click)="showUploadDetails()">
          <fa-icon icon="angle-down" (click)="showUploadDetails()"></fa-icon>&nbsp;
          <span jhiTranslate="dmsApp.document.docDetailLabel">Document Upload Details</span>
        </div>

        <div *ngIf="!isUploadDetail" class="tab-header" (click)="showUploadDetails()">
          <fa-icon icon="angle-right" (click)="showUploadDetails()"></fa-icon>&nbsp;
          <span jhiTranslate="dmsApp.document.docDetailLabel">Document Upload Details</span>
        </div>
      </div>
    </div>

    <div id="docMapping">
      <div *ngIf="isDocMap" id="search-area" class="col-12">
        <div class="row col-12">
          <div class="form-group col-6" [hidden]="editForm.get('id')!.value == null">
            <div class="col-2">
              <label class="form-control-label" jhiTranslate="global.field.id" for="field_id">ID</label>
            </div>
            <div class="col-4">
              <input type="number" class="form-control" name="id" id="field_id" data-cy="id" formControlName="id" [readonly]="true" />
            </div>
          </div>

          <div *ngIf="!isNA" class="from-group col-6">
            <div *ngIf="docStatus_number === 3 || docStatus_number === 6">
              <label class="form-control-label" jhiTranslate="dmsApp.document.status" for="text">Status</label>
              <div>
                <span style="color: red; font-weight: bold"> {{ docStatus }} </span>
              </div>
            </div>

            <div *ngIf="docStatus_number !== 3 && docStatus_number !== 6">
              <label class="form-control-label" jhiTranslate="dmsApp.document.status" for="text">Status</label>
              <div>
                <span style="color: green; font-weight: bold"> {{ docStatus }} </span>
              </div>
            </div>
          </div>
        </div>

        <div class="row col-12">
          <div class="form-group col-6">
            <label class="form-control-label" jhiTranslate="dmsApp.document.docTitle" for="field_docType">Documnet Template</label>
            <span class="text-danger">*</span>
            <select (change)="onDocTemplateChange($event)" class="form-control" formControlName="metaDataHeaderId">
              <option [value]="doctype.id" *ngFor="let doctype of docTypes">
                {{ doctype.docTitle }}
              </option>
            </select>
          </div>

          <div class="form-group col-6">
            <label class="form-control-label" jhiTranslate="dmsApp.document.message" for="text">Message </label>
            <input type="text" class="form-control" name="message" formControlName="message" />
          </div>
        </div>

        <div class="row col-12">
          <div class="form-group col-6">
            <label class="form-control-label" jhiTranslate="dmsApp.document.priority" for="text">Priority</label>
            <select class="form-control" formControlName="priority">
              <option [value]="priority.value" *ngFor="let priority of _priority">
                {{ priority.description }}
              </option>
            </select>
          </div>

          <div *ngIf="docStatus_number === 4" class="form-group col-6">
            <label class="form-control-label" jhiTranslate="dmsApp.document.ammendment" for="text"></label>
            <input type="text" class="form-control" name="ammendment" formControlName="ammendment" />
          </div>

          <div *ngIf="docStatus_number === 6" class="form-group col-6">
            <label class="form-control-label" jhiTranslate="dmsApp.document.reject" for="text"></label>
            <input type="text" class="form-control" name="reject" formControlName="reject" />
          </div>
        </div>

        <div class="row col-12" *ngFor="let metaitem of metaData">
          <div class="form-group col-6" *ngIf="metaitem.fieldType == 'String'">
            <label class="form-control-label" for="text"> {{ metaitem.fieldName }} </label>
            <span *ngIf="metaitem.isRequired == 'YES'" class="text-danger">*</span>

            <input
              type="text"
              class="form-control"
              [name]="metaitem.fieldName"
              [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'"
            />
          </div>

          <div class="form-group col-6" *ngIf="metaitem.fieldType == 'Number'">
            <label class="form-control-label" for="text">
              {{ metaitem.fieldName }} <span *ngIf="metaitem.isRequired == 'YES'" class="text-danger">*</span></label
            >
            <input
              type="number"
              class="form-control"
              [name]="metaitem.fieldName"
              [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'"
            />
          </div>

          <div class="form-group col-6" *ngIf="metaitem.fieldType == 'LOV'">
            <label class="form-control-label" for="text">
              {{ metaitem.fieldName }} <span *ngIf="metaitem.isRequired == 'YES'" class="text-danger">*</span></label
            >
            <select class="form-control" [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'">
              <option [value]="f_value" *ngFor="let f_value of getFieldValues(metaitem.fieldValue)">
                {{ f_value }}
              </option>
            </select>
          </div>

          <div class="form-group col-3" *ngIf="metaitem.fieldType == 'Date'">
            <label class="form-control-label" for="text">
              {{ metaitem.fieldName }} <span *ngIf="metaitem.isRequired == 'YES'" class="text-danger">*</span></label
            >
            <input
              type="date"
              class="form-control"
              [name]="metaitem.fieldName"
              [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'"
            />
          </div>
        </div>
      </div>
    </div>

    <div id="uploadDetail">
      <div id="search-area" *ngIf="isUploadDetail" class="col-12">
        <div class="row col-12">
          <div class="form-group col-6">
            <label class="form-control-label" jhiTranslate="dmsApp.document.repositoryURL" for="text"> Repository URL </label>
            <div class="input-group col-12" style="padding: 0px !important">
              <input
                type="text"
                readonly
                placeholder="Repository"
                formControlName="reposistory"
                class="form-control input-sm"
                style="background: white"
                (click)="searchRepository()"
              />
              <div class="input-group-append">
                <span class="input-sm input-btn-primary" (click)="searchRepository()">
                  <fa-icon icon="search"></fa-icon>
                </span>
              </div>
            </div>
          </div>

          <div class="form-group col-6">
            <label class="form-control-label" for="text">&nbsp;</label>
            <form enctype="multipart/form-data">
              <fieldset>
                <div class="form-group">
                  <button class="btn btn-primary btn-sm" (click)="checkRepositoryURL(inputFileElement)">
                    <fa-icon icon="upload"></fa-icon>
                    <span class="d-none d-md-inline" jhiTranslate="dmsApp.document.chooseFile">Choose File</span>
                  </button>
                  <input #inputFileElement type="file" (change)="onUploadFiles($event)" name="files" multiple />
                </div>
              </fieldset>
            </form>
          </div>
        </div>

        <div class="form-group" style="padding: 8px !important; overflow-x: auto">
          <table class="table" formArrayName="docList1">
            <thead>
              <tr>
                <th class="text-center" style="width: 25%" jhiTranslate="dmsApp.document.fileLocation">Repository URL</th>
                <th class="text-center" style="width: 20%" jhiTranslate="dmsApp.document.fileName">File Name</th>
                <th class="text-center" style="width: 10%" jhiTranslate="dmsApp.document.fileSize">File Size (KB)</th>
                <th class="text-center" style="width: 5%" jhiTranslate="dmsApp.document.fileVersion">Version<span>&nbsp;*</span></th>
                <th class="text-center" style="width: 30%" jhiTranslate="dmsApp.document.remark">Remark</th>
                <th class="text-center" style="width: 5%" jhiTranslate="dmsApp.document.fieldAction">#</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of docList1().controls; last as isLast; let i = index" [formGroupName]="i">
                <td>
                  <input type="text" class="col-12 form-control" placeholder="filePath" formControlName="filePath" readonly />
                </td>
                <td>
                  <input
                    type="text"
                    class="col-12 form-control"
                    placeholder="fileName"
                    formControlName="fileName"
                    [readonly]="item.get(['id'])!.value != null"
                  />
                </td>
                <td>
                  <input type="number" class="col-12 form-control" placeholder="filesize" formControlName="fileSize" readonly />
                </td>
                <td>
                  <input type="number" class="col-12 form-control" placeholder="version" formControlName="version" />
                </td>
                <td>
                  <input type="text" class="col-12 form-control" placeholder="remark" formControlName="remark" />
                </td>
                <td style="padding-left: 10px">
                  <span title="Remove" (click)="removeField(i)">
                    <fa-icon icon="minus" class="fa-icon-theme text-danger"></fa-icon>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </form>
</div>
