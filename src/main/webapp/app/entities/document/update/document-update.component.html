<div id="page-heading" class="row">
  <div class="col-10">
    <span>Document</span>
    <span> >> Document Mapping <small></small></span>
  </div>

  <div class="col-2 d-flex justify-content-end">
    <button
      type="button"
      id="save-entity"
      data-cy="entityCreateSaveButton"
      class="btn btn-primary btn-sm"
      [disabled]="editForm.invalid || isSaving"
      [title]="saveBtnTitleChange()"
      (click)="save()"
    >
      <fa-icon icon="save"></fa-icon>
      <span class="d-none d-md-inline" jhiTranslate="entity.action.save">Save</span>
    </button>
    <span style="width: 5px"></span>
    <button type="button" id="cancel-save" class="btn btn-primary btn-sm" (click)="previousState()">
      <fa-icon icon="plus"></fa-icon>
      <span class="d-none d-md-inline">New</span>
    </button>
  </div>
</div>

<div class="row">
  <form name="editForm" role="form" novalidate (ngSubmit)="save()" [formGroup]="editForm">
    <jhi-alert-error></jhi-alert-error>
    <div *ngIf="fileStatus.status === 'progress'">
      <div class="progress" style="height: 15px; font-size: 12px">
        <div
          [style.width.%]="fileStatus.percent"
          class="progress-bar progress-bar-animated bg-info"
          role="progressbar"
          aria-valuenow="50"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          {{ fileStatus.requestType }} {{ fileStatus.percent }}
        </div>
      </div>
    </div>
    <div class="form-group row col-6" [hidden]="editForm.get('id')!.value == null">
      <div class="col-1">
        <label class="form-control-label" jhiTranslate="global.field.id" for="field_id">ID</label>
      </div>
      <div class="col-4">
        <input type="number" class="form-control" name="id" id="field_id" data-cy="id" formControlName="id" [readonly]="true" />
      </div>
    </div>

    <div class="row col-12">
      <div class="form-group col-6">
        <!-- <label class="form-control-label" jhiTranslate="dmsApp.document.docTitle" for="field_docType">Documnet Template </label
        ><span style="color: red">&nbsp;*</span>
        <select (change)="onChange($event)" class="form-control" formControlName="metaDataHeaderId"> -->

        <label class="form-control-label" jhiTranslate="dmsApp.document.docTitle" for="field_docType">Documnet Template</label>
        <select (change)="onDocTemplateChange($event)" class="form-control" formControlName="metaDataHeaderId">
          <option [value]="doctype.id" *ngFor="let doctype of docTypes">
            {{ doctype.docTitle }}
          </option>
        </select>
        <div class="form-group col-6" *ngIf="metaDataHeaderId && metaDataHeaderId.touched && metaDataHeaderId.invalid" style="color: red">
          This field is required.
        </div>
      </div>

      <div class="form-group col-6">
        <label class="form-control-label" jhiTranslate="dmsApp.document.message" for="text">Message </label>

        <input type="text" class="form-control" name="message" formControlName="message" />
        <div class="form-group col-6" *ngIf="message && message.touched && message.invalid" style="color: red">This field is required.</div>
      </div>
    </div>

    <div class="row col-12" *ngFor="let metaitem of metaData">
      <div class="form-group col-6" *ngIf="metaitem.fieldType == 'String'">
        <label class="form-control-label" for="text"> {{ metaitem.fieldName }} </label>
        <span *ngIf="metaitem.isRequired == 'YES'" style="color: red">*</span>

        <input
          type="text"
          class="form-control"
          [name]="metaitem.fieldName"
          [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'"
        />
      </div>
    </div>

    <div class="row col-12" *ngFor="let metaitem of metaData">
      <div class="form-group col-6" *ngIf="metaitem.fieldType == 'Number'">
        <label class="form-control-label" for="text">
          {{ metaitem.fieldName }} <span *ngIf="metaitem.isRequired == 'YES'" style="color: red">*</span></label
        >
        <input
          type="number"
          class="form-control"
          [name]="metaitem.fieldName"
          [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'"
        />
      </div>
    </div>

    <div class="row col-12" *ngFor="let metaitem of metaData">
      <div class="form-group col-6" *ngIf="metaitem.fieldType == 'LOV'">
        <label class="form-control-label" for="text">
          {{ metaitem.fieldName }} <span *ngIf="metaitem.isRequired == 'YES'" style="color: red">*</span></label
        >
        <select class="form-control" [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'">
          <option [value]="f_value" *ngFor="let f_value of getFieldValues(metaitem.fieldValue)">
            {{ f_value }}
          </option>
        </select>
      </div>
    </div>

    <div class="row col-12" *ngFor="let metaitem of metaData">
      <div class="form-group col-6" *ngIf="metaitem.fieldType == 'Date'">
        <label class="form-control-label" for="text">
          {{ metaitem.fieldName }} <span *ngIf="metaitem.isRequired == 'YES'" style="color: red">*</span></label
        >
        <input
          type="date"
          class="form-control"
          [name]="metaitem.fieldName"
          [formControlName]="metaitem.fieldName! + '_' + metaitem.id + '_fieldName'"
        />
      </div>
    </div>

    <div class="col-12">
      <span style="text-decoration: underline; font-weight: bold">Document Upload Details</span>
    </div>

    <div class="row col-12">
      <div class="form-group col-6">
        <label class="form-control-label" jhiTranslate="dmsApp.document.repositoryURL" for="text"> Repository URL </label>
        <div class="input-group col-12" style="padding: 0px !important">
          <input
            type="text"
            readonly
            placeholder="Repository"
            formControlName="reposistory"
            class="form-control input-sm"
            style="background: white"
            (click)="searchRepository()"
          />
          <div class="input-group-append">
            <span class="input-sm input-btn-primary" (click)="searchRepository()">
              <fa-icon icon="search"></fa-icon>
            </span>
          </div>
        </div>
      </div>

      <div class="form-group col-6">
        <label class="form-control-label" for="text"></label>
        <form enctype="multipart/form-data">
          <fieldset>
            <div class="form-group">
              <button class="btn btn-primary btn-sm" (click)="checkRepositoryURL(inputFileElement)">
                <fa-icon icon="upload"></fa-icon>
                <span class="d-none d-md-inline">Choose Files</span>
              </button>
              <input #inputFileElement type="file" (change)="onUploadFiles($event)" name="files" multiple />
            </div>
          </fieldset>
        </form>
      </div>
    </div>

    <div class="form-group" style="padding: 8px !important; overflow-x: auto">
      <table class="table" formArrayName="docList1">
        <thead>
          <tr>
            <th class="text-center" style="width: 25%">Repository URL</th>
            <th class="text-center" style="width: 20%">File Name</th>
            <th class="text-center" style="width: 10%">File Size (KB)</th>
            <th class="text-center" style="width: 5%">Version<span style="color: red">&nbsp;*</span></th>
            <th class="text-center" style="width: 30%">Remark</th>
            <th class="text-center" style="width: 5%">Remove</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of docList1().controls; last as isLast; let i = index" [formGroupName]="i">
            <td>
              <input type="text" class="col-12 form-control" placeholder="filePath" formControlName="filePath" readonly />
            </td>
            <td>
              <input type="text" class="col-12 form-control" placeholder="fileName" formControlName="fileName" readonly />
            </td>
            <td>
              <input type="number" class="col-12 form-control" placeholder="filesize" formControlName="fileSize" readonly />
            </td>
            <td>
              <input type="number" class="col-12 form-control" placeholder="version" formControlName="version" />
            </td>
            <td>
              <input type="text" class="col-12 form-control" placeholder="remark" formControlName="remark" />
            </td>
            <td style="padding-left: 10px">
              <span title="Remove" (click)="removeField(i)">
                <fa-icon icon="minus" class="fa-icon-theme text-danger"></fa-icon>
              </span>

              <!-- <span *ngIf="isLast" title="Add" (click)="addField()">
                    <fa-icon icon="plus" class="fa-icon-theme text-success"></fa-icon>
                  </span> -->
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </form>
</div>
